apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "tractor-kpm-oai.fullname" . }}-config
data:
  metrics_config.py: |
    # Auto-generated by Helm
    {{- $dm := .Values.defaultMetrics }}
    {{- $mo := .Values.metricOrder }}

    DEFAULT_METRICS = {
    {{- $lastIndex := sub (len $mo) 1 }}
    {{- range $i, $k := $mo }}
        "{{ $k }}": {{ toJson (index $dm $k) }}{{ if ne $i $lastIndex }},{{ end }}
    {{- end }}
    }

    METRIC_ORDER = [
    {{- range $i, $k := $mo }}
        "{{ $k }}"{{ if ne $i $lastIndex }},{{ end }}
    {{- end }}
    ]